<script>
  jQuery(function ($) {
    // üîπ Capture current location and fill inputs
    function captureLocation(modalId) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // Fill the latitude & longitude fields
            $(`${modalId} #latitude`).val(latitude);
            $(`${modalId} #longitude`).val(longitude);

            // Generate Google Maps URL
            const mapLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
            $(`${modalId} #google_map_location`).val(mapLink);

            // Optional success feedback
            alert("‚úÖ Location captured successfully!");
          },
          function (error) {
            switch (error.code) {
              case error.PERMISSION_DENIED:
                alert("‚ùå Permission denied. Please allow location access.");
                break;
              case error.POSITION_UNAVAILABLE:
                alert("‚ö†Ô∏è Location information is unavailable.");
                break;
              case error.TIMEOUT:
                alert("‚è±Ô∏è Request timed out. Try again.");
                break;
              default:
                alert("Error capturing location: " + error.message);
            }
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    // üîπ Capture button click (Add Modal)
    $(document).on("click", "#add_modal #get-location-btn", function () {
      captureLocation("#add_modal");
    });

    // üîπ Capture button click (Edit Modal)
    $(document).on("click", "#edit_modal #get-location-btn", function () {
      captureLocation("#edit_modal");
    });

    // üîπ Edit record AJAX load
    $(document).on("click", ".edit_record", function () {
      let id = $(this).val();

      $.ajax({
        url: "<?php echo site_url('get-data'); ?>",
        type: "POST",
        data: { tbl: "customer_info", id: id },
        dataType: "json",
        success: function (d) {
          console.log(d);

          // ‚úÖ Populate fields in Edit modal
          $("#edit_modal #customer_id").val(d.customer_id);
          $("#edit_modal #customer_name").val(d.customer_name);
          $("#edit_modal #contact_name").val(d.contact_name);
          $("#edit_modal #crno").val(d.crno);
          $("#edit_modal #country").val(d.country);
          $("#edit_modal #address").val(d.address);
          $("#edit_modal #mobile").val(d.mobile);
          $("#edit_modal #mobile_alt").val(d.mobile_alt);
          $("#edit_modal #email").val(d.email);
          $("#edit_modal #remarks").val(d.remarks);
          $("#edit_modal #customer_code").val(d.customer_code);
          $("#edit_modal #gst").val(d.gst);
          $("#edit_modal #latitude").val(d.latitude);
          $("#edit_modal #longitude").val(d.longitude);
          $("#edit_modal #google_map_location").val(d.google_map_location);

          // ‚úÖ Handle status
          $(`#edit_modal input[name="status"][value="${d.status}"]`).prop(
            "checked",
            true
          );

          // ‚úÖ Show Edit modal
          $("#edit_modal").modal("show");
        },
        error: function (xhr, status, error) {
          alert("Error fetching data: " + error);
        },
      });
    });

    // üîπ Delete record
    $(document).on("click", ".del_record", function () {
      let id = $(this).val();
      if (confirm("Are you sure you want to delete this vendor?")) {
        $.ajax({
          url: "<?php echo site_url('delete-record'); ?>",
          type: "POST",
          data: { tbl: "customer_info", id: id },
          success: function (response) {
            alert(response);
            location.reload();
          },
          error: function (xhr, status, error) {
            alert("Error deleting record: " + error);
          },
        });
      }
    });
  });
</script>
